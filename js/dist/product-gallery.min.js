/*! HOLY LABEL Product Gallery v1.0.0 | (c) 2024 | MIT License */
/**
 * HOLY LABEL - Product Image Gallery Library
 * Advanced product image gallery with carousel and zoom functionality
 * @version 1.0.0
 * @namespace window.HolyLabelProductGallery
 * @requires window.HolyLabelDOMUtils
 */
!function(e){"use strict";const t={currentIndex:0,images:[],elements:{mainContainer:null,thumbnailContainer:null,counter:null},init(){this.elements.mainContainer=document.getElementById("mainImageContainer"),this.elements.thumbnailContainer=document.getElementById("thumbnailContainer"),this.elements.counter=document.getElementById("imageCounter"),this.elements.mainContainer&&this.elements.thumbnailContainer&&(this.collectImages(),0!==this.images.length&&(this.renderImages(),this.addEventListeners(),this.updateUI()))},collectImages(){const e=document.getElementById("imageData");if(!e)return;const t=e.querySelectorAll("span[data-main]");this.images=Array.from(t).map(e=>({main:e.getAttribute("data-main"),thumb:e.getAttribute("data-thumb")})).filter(e=>e.main&&e.thumb)},renderImages(){let e="",t="";const n=document.querySelector(".product-detail-title")?.textContent||"商品画像";this.images.forEach((i,s)=>{e+=`<div class="main-image-item"><img src="${i.main}" alt="${n} ${s+1}"></div>`,t+=`<div class="thumbnail-item" data-index="${s}"><img src="${i.thumb}" alt="${n} サムネイル ${s+1}"></div>`}),this.elements.mainContainer.innerHTML=e,this.elements.thumbnailContainer.innerHTML=t},addEventListeners(){let e;this.elements.mainContainer.addEventListener("scroll",()=>{e&&clearTimeout(e),e=setTimeout(()=>{const e=this.elements.mainContainer.offsetWidth,t=this.elements.mainContainer.scrollLeft,n=Math.round(t/e),i=Math.max(0,Math.min(n,this.images.length-1));i!==this.currentIndex&&(this.currentIndex=i,this.updateUI())},50)}),this.elements.thumbnailContainer.addEventListener("click",e=>{const t=e.target.closest(".thumbnail-item");if(t){const e=parseInt(t.dataset.index,10);this.scrollToImage(e)}});const t=document.getElementById("prevBtn"),n=document.getElementById("nextBtn");t&&n&&(t.addEventListener("click",e=>{e.preventDefault(),this.scrollToImage(this.currentIndex-1)}),n.addEventListener("click",e=>{e.preventDefault(),this.scrollToImage(this.currentIndex+1)}));const i=document.getElementById("zoomBtn");i&&i.addEventListener("click",()=>this.openZoomModal()),document.addEventListener("keydown",e=>{document.querySelector(".product-detail")&&("ArrowLeft"===e.key?(e.preventDefault(),this.scrollToImage(this.currentIndex-1)):"ArrowRight"===e.key&&(e.preventDefault(),this.scrollToImage(this.currentIndex+1)))})},scrollToImage(e){if(0===this.images.length)return;let t=e;if(t<0?t=this.images.length-1:t>=this.images.length&&(t=0),t===this.currentIndex)return;this.currentIndex=t;const n=t*this.elements.mainContainer.offsetWidth;this.elements.mainContainer.scrollTo({left:n,behavior:"smooth"}),this.updateUI()},openZoomModal(){if(0===this.images.length)return;const e=document.createElement("div");e.className="zoom-modal",e.innerHTML=`\n                <div class="zoom-modal-content">\n                    <button class="zoom-close">&times;</button>\n                    <img src="${this.images[this.currentIndex].main}" alt="商品画像拡大">\n                    <div class="zoom-counter">${this.currentIndex+1}/${this.images.length}</div>\n                    ${this.images.length>1?'\n                        <button class="zoom-prev">‹</button>\n                        <button class="zoom-next">›</button>\n                    ':""}\n                </div>\n            `,document.body.appendChild(e),document.body.style.overflow="hidden";const t=e.querySelector(".zoom-close"),n=e.querySelector(".zoom-prev"),i=e.querySelector(".zoom-next"),s=e.querySelector("img"),o=e.querySelector(".zoom-counter");let l=this.currentIndex;const a=()=>{s.src=this.images[l].main,o.textContent=`${l+1}/${this.images.length}`};t.addEventListener("click",()=>{document.body.removeChild(e),document.body.style.overflow=""}),n&&i&&(n.addEventListener("click",()=>{l=l>0?l-1:this.images.length-1,a()}),i.addEventListener("click",()=>{l=l<this.images.length-1?l+1:0,a()}));const r=e=>{"Escape"===e.key&&(t.click(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),e.addEventListener("click",n=>{n.target===e&&t.click()})},updateUI(){this.elements.counter&&(this.images.length>1?(this.elements.counter.textContent=`${this.currentIndex+1}/${this.images.length}`,this.elements.counter.style.display="block"):this.elements.counter.style.display="none");const e=document.getElementById("prevBtn"),t=document.getElementById("nextBtn");e&&t&&(this.images.length>1?(e.style.display="flex",t.style.display="flex"):(e.style.display="none",t.style.display="none"));const n=this.elements.thumbnailContainer.querySelectorAll(".thumbnail-item");n.forEach((e,t)=>{e.classList.toggle("active",t===this.currentIndex)});const i=n[this.currentIndex];if(i){const e=this.elements.thumbnailContainer,t=i.offsetLeft-e.offsetWidth/2+i.offsetWidth/2;e.scrollTo({left:t,behavior:"smooth"})}},handleResize(){if(0===this.images.length)return;const e=this.currentIndex*this.elements.mainContainer.offsetWidth;this.elements.mainContainer.scrollLeft=e},destroy(){this.elements={mainContainer:null,thumbnailContainer:null,counter:null},this.images=[],this.currentIndex=0}};e.HolyLabelProductGallery=t,e.ProductImageGallery||(e.ProductImageGallery=t),e.addEventListener("resize",()=>{t.elements.mainContainer&&t.handleResize()})}(window);