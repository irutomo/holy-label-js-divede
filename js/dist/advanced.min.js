/*! HOLY LABEL Advanced Bundle v1.0.0 | (c) 2024 | MIT License */
!function(t){"use strict";const ProductImageGallery={currentIndex:0,images:[],elements:{mainContainer:null,thumbnailContainer:null,counter:null},init(){this.elements.mainContainer=document.getElementById("mainImageContainer"),this.elements.thumbnailContainer=document.getElementById("thumbnailContainer"),this.elements.counter=document.getElementById("imageCounter"),this.elements.mainContainer&&this.elements.thumbnailContainer&&(this.collectImages(),0!==this.images.length&&(this.renderImages(),this.addEventListeners(),this.updateUI()))},collectImages(){const t=document.getElementById("imageData");if(!t)return;const e=t.querySelectorAll("span[data-main]");this.images=Array.from(e).map(t=>({main:t.getAttribute("data-main"),thumb:t.getAttribute("data-thumb")})).filter(t=>t.main&&t.thumb)},renderImages(){let t="",e="";const n=document.querySelector(".product-detail-title")?.textContent||"商品画像";this.images.forEach((i,s)=>{t+=`<div class="main-image-item"><img src="${i.main}" alt="${n} ${s+1}"></div>`,e+=`<div class="thumbnail-item" data-index="${s}"><img src="${i.thumb}" alt="${n} サムネイル ${s+1}"></div>`}),this.elements.mainContainer.innerHTML=t,this.elements.thumbnailContainer.innerHTML=e},addEventListeners(){this.elements.mainContainer.addEventListener("scroll",()=>{const t=Math.round(this.elements.mainContainer.scrollLeft/this.elements.mainContainer.offsetWidth);t!==this.currentIndex&&(this.currentIndex=t,this.updateUI())}),this.elements.thumbnailContainer.addEventListener("click",t=>{const e=t.target.closest(".thumbnail-item");if(e){const t=parseInt(e.dataset.index,10);this.scrollToImage(t)}});const t=document.getElementById("prevBtn"),e=document.getElementById("nextBtn");t&&e&&(t.addEventListener("click",()=>this.scrollToImage(this.currentIndex-1)),e.addEventListener("click",()=>this.scrollToImage(this.currentIndex+1)));const n=document.getElementById("zoomBtn");n&&n.addEventListener("click",()=>this.openZoomModal()),document.addEventListener("keydown",t=>{document.querySelector(".product-detail")&&("ArrowLeft"===t.key?(t.preventDefault(),this.scrollToImage(this.currentIndex-1)):"ArrowRight"===t.key&&(t.preventDefault(),this.scrollToImage(this.currentIndex+1)))})},scrollToImage(t){if(0===this.images.length)return;let e=t;e<0?e=this.images.length-1:e>=this.images.length&&(e=0),this.currentIndex=e;const n=e*this.elements.mainContainer.offsetWidth;this.elements.mainContainer.scrollTo({left:n,behavior:"smooth"}),this.updateUI()},openZoomModal(){if(0===this.images.length)return;const t=document.createElement("div");t.className="zoom-modal",t.innerHTML=`\n                <div class="zoom-modal-content">\n                    <button class="zoom-close">&times;</button>\n                    <img src="${this.images[this.currentIndex].main}" alt="商品画像拡大">\n                    <div class="zoom-counter">${this.currentIndex+1}/${this.images.length}</div>\n                    ${this.images.length>1?'\n                        <button class="zoom-prev">‹</button>\n                        <button class="zoom-next">›</button>\n                    ':""}\n                </div>\n            `,document.body.appendChild(t),document.body.style.overflow="hidden";const e=t.querySelector(".zoom-close"),n=t.querySelector(".zoom-prev"),i=t.querySelector(".zoom-next"),s=t.querySelector("img"),o=t.querySelector(".zoom-counter");let a=this.currentIndex;const l=()=>{s.src=this.images[a].main,o.textContent=`${a+1}/${this.images.length}`};e.addEventListener("click",()=>{document.body.removeChild(t),document.body.style.overflow=""}),n&&i&&(n.addEventListener("click",()=>{a=a>0?a-1:this.images.length-1,l()}),i.addEventListener("click",()=>{a=a<this.images.length-1?a+1:0,l()}));const r=t=>{"Escape"===t.key&&(e.click(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),t.addEventListener("click",n=>{n.target===t&&e.click()})},updateUI(){this.elements.counter&&(this.images.length>1?(this.elements.counter.textContent=`${this.currentIndex+1}/${this.images.length}`,this.elements.counter.style.display="block"):this.elements.counter.style.display="none");const t=document.getElementById("prevBtn"),e=document.getElementById("nextBtn");t&&e&&(this.images.length>1?(t.style.display="flex",e.style.display="flex"):(t.style.display="none",e.style.display="none"));const n=this.elements.thumbnailContainer.querySelectorAll(".thumbnail-item");n.forEach((t,e)=>{t.classList.toggle("active",e===this.currentIndex)});const i=n[this.currentIndex];if(i){const t=this.elements.thumbnailContainer,e=i.offsetLeft-t.offsetWidth/2+i.offsetWidth/2;t.scrollTo({left:e,behavior:"smooth"})}},handleResize(){if(0===this.images.length)return;const t=this.currentIndex*this.elements.mainContainer.offsetWidth;this.elements.mainContainer.scrollLeft=t},destroy(){this.elements={mainContainer:null,thumbnailContainer:null,counter:null},this.images=[],this.currentIndex=0}};t.HolyLabelProductGallery=ProductImageGallery,t.ProductImageGallery||(t.ProductImageGallery=ProductImageGallery),t.addEventListener("resize",()=>{ProductImageGallery.elements.mainContainer&&ProductImageGallery.handleResize()})}(window),function(t){"use strict";const LoadMoreManager={elements:{get btn(){return(t.HolyLabelDOMUtils||t.DOMUtils).getId("load-more-btn")},get maxPage(){return(t.HolyLabelDOMUtils||t.DOMUtils).getId("max_page")},get nextPage(){return(t.HolyLabelDOMUtils||t.DOMUtils).getId("next_page")},get productGrid(){return(t.HolyLabelDOMUtils||t.DOMUtils).getId("product-grid")}},loading:!1,init(){const{btn:t}=this.elements;t&&(this.updateButtonVisibility(),t.addEventListener("click",()=>this.loadMore()),this.initInfiniteScroll())},updateButtonVisibility(){const{btn:t,maxPage:e,nextPage:n}=this.elements;if(!t||!e||!n)return;const i=parseInt(n.textContent||"1",10)-1,s=parseInt(e.textContent||"1",10);t.style.display=i>=s?"none":"block"},async loadMore(){if(this.loading)return;const{btn:t,nextPage:e,productGrid:n}=this.elements;if(!t||!e||!n)return;this.loading=!0;const i=parseInt(e.textContent||"1",10);this.setLoadingState(!0);try{const t=await this.fetchMoreItems(i);t.success&&t.items?(this.appendItems(t.items),e.textContent=i+1,this.updateButtonVisibility(),this.animateNewItems()):this.showError("商品の読み込みに失敗しました。")}catch(t){console.error("Load more error:",t),this.showError("ネットワークエラーが発生しました。")}finally{this.loading=!1,this.setLoadingState(!1)}},async fetchMoreItems(e){const n=new URL(t.location.href);n.searchParams.set("page",e);const i=await fetch(n.toString(),{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const s=await i.text();return this.parseResponse(s)},parseResponse(t){const e=(new DOMParser).parseFromString(t,"text/html").querySelectorAll(".product-item");return{success:e.length>0,items:Array.from(e).map(t=>t.outerHTML)}},appendItems(t){const{productGrid:e}=this.elements;if(!e)return;const n=document.createDocumentFragment();t.forEach(t=>{const e=document.createElement("div");e.innerHTML=t;const i=e.firstElementChild;i&&(i.classList.add("new-item"),n.appendChild(i))}),e.appendChild(n)},animateNewItems(){const e=t.HolyLabelDOMUtils||t.DOMUtils,n=t.HolyLabelAnimationManager||t.AnimationManager;e.getAll(".product-item.new-item").forEach((t,e)=>{t.style.opacity="0",t.style.transform="translateY(30px)",setTimeout(()=>{t.style.transition="opacity 0.6s ease, transform 0.6s ease",t.style.opacity="1",t.style.transform="translateY(0)",setTimeout(()=>{t.classList.remove("new-item"),t.style.transition=""},600)},100*e)}),n&&n.animateOnScroll&&setTimeout(()=>{n.animateOnScroll()},100)},setLoadingState(t){const{btn:e}=this.elements;e&&(t?(e.disabled=!0,e.textContent="読み込み中...",e.classList.add("loading")):(e.disabled=!1,e.textContent="もっと見る",e.classList.remove("loading")))},showError(e){t.HolyLabelModalUtils?t.HolyLabelModalUtils.alert(e):alert(e)},initInfiniteScroll(){if(!this.isInfiniteScrollEnabled())return;let e=!1;t.addEventListener("scroll",()=>{e||(requestAnimationFrame(()=>{t.scrollY+t.innerHeight>=document.documentElement.scrollHeight-200&&this.loadMore(),e=!1}),e=!0)},{passive:!0})},isInfiniteScrollEnabled:()=>"true"===document.body.dataset.infiniteScroll||document.body.classList.contains("infinite-scroll"),initSearchFilter(){const e=(t.HolyLabelDOMUtils||t.DOMUtils).get(".search-form");e&&e.addEventListener("submit",t=>{this.isAjaxSearchEnabled()&&(t.preventDefault(),this.performAjaxSearch())})},isAjaxSearchEnabled:()=>"true"===document.body.dataset.ajaxSearch,async performAjaxSearch(){}};t.HolyLabelLoadMoreManager=LoadMoreManager,t.LoadMoreManager||(t.LoadMoreManager=LoadMoreManager)}(window),function(t){"use strict";const LogoManager={updatePosition(){const e=t.HolyLabelDOMUtils||t.DOMUtils,n=t.HolyLabelPageState||t.PageState,i=t.HolyLabelNavigationManager||t.NavigationManager,s=e.logo();if(!s)return;const o=!!i&&i.isActive(),a=!!n&&n.isHomePage();s.classList.remove("center-position","header-position","menu-open-position"),o?s.classList.add("menu-open-position"):a?s.classList.add("center-position"):s.classList.add("header-position")},handleScroll(){const e=t.HolyLabelDOMUtils||t.DOMUtils,n=t.HolyLabelPageState||t.PageState;if(!n||!n.isHomePage())return;const i=e.logo();if(!i)return;const s=t.scrollY,o=e.get(".main-visual");if(o){const t=s>.8*o.offsetHeight;i.classList.toggle("scrolled",t)}},initLogoClick(){const e=(t.HolyLabelDOMUtils||t.DOMUtils).logo();if(!e)return;const n=e.querySelector("a");n&&n.addEventListener("click",e=>{"/"!==t.location.pathname&&"/index.html"!==t.location.pathname||(e.preventDefault(),this.scrollToTop())})},scrollToTop(){t.scrollTo({top:0,behavior:"smooth"})},fadeInOut(e=!0){const n=(t.HolyLabelDOMUtils||t.DOMUtils).logo();n&&(e?(n.style.opacity="1",n.style.transition="opacity 0.3s ease"):(n.style.opacity="0",n.style.transition="opacity 0.3s ease"))},handleResize(){const e=t.innerWidth<=768,n=(t.HolyLabelDOMUtils||t.DOMUtils).logo();n&&(n.classList.toggle("mobile",e),n.classList.toggle("desktop",!e),this.updatePosition())},init(){let e,n;this.updatePosition(),this.initLogoClick(),t.addEventListener("scroll",()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.handleScroll()},10)},{passive:!0}),t.addEventListener("resize",()=>{n&&clearTimeout(n),n=setTimeout(()=>{this.handleResize()},250)}),this.handleResize()},initCategoryDisplay(){const e=(t.HolyLabelDOMUtils||t.DOMUtils).get('a.expand[href="#"]');if("ITEM"===e?.textContent.trim()){const t=e.nextElementSibling;if(t){const e=t.querySelectorAll("li:not(.no-category-message)"),n=t.querySelector(".no-category-message");0===e.length&&n&&(n.style.display="block")}}},controlInstagramButton(){const e=t.HolyLabelDOMUtils||t.DOMUtils,n=t.HolyLabelPageState||t.PageState;e.get(".instagram-fixed-btn")&&e.body().classList.toggle("home-page",!!n&&n.isHomePage())},initAll(){this.init(),this.initCategoryDisplay(),this.controlInstagramButton()}};t.HolyLabelLogoManager=LogoManager,t.LogoManager||(t.LogoManager=LogoManager),t.initCategoryDisplay=LogoManager.initCategoryDisplay.bind(LogoManager),t.controlInstagramButton=LogoManager.controlInstagramButton.bind(LogoManager)}(window);